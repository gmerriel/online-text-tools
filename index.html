<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sentence Split & Clean</title>
  <style>
    :root { --bg:#0b0c10; --card:#111318; --muted:#97a0ad; --text:#e7ebf3; --accent:#4da3ff; }
    * { box-sizing: border-box; }
    body { margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width:1100px; margin:32px auto; padding:0 16px; }
    .header { display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .title { font-weight:700; letter-spacing:.2px; }
    .muted { color:var(--muted); font-size:14px; }
    .card { background:var(--card); border:1px solid #1a1d24; border-radius:14px; padding:14px; }
    .grid { display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width:900px){ .grid { grid-template-columns:1fr 1fr; } }
    textarea { width:100%; min-height:420px; resize:vertical; background:#0e1016; color:var(--text); border:1px solid #20232b; border-radius:10px; padding:12px 12px 44px; outline:none; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn { border:1px solid #20232b; background:#141822; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; }
    .btn:hover { border-color:#2b3340; }
    .btn.primary { background:var(--accent); color:#00142a; border-color:transparent; font-weight:700; }
    .btn.ghost { background:transparent; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    label { display:flex; align-items:center; gap:8px; font-size:14px; color:var(--muted); cursor:pointer; }
    .footer { margin-top:8px; font-size:12px; color:var(--muted); text-align:right; }
    .hint { font-size:12px; color:var(--muted); margin-top:-6px; }
    .toolbar { display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; position:relative; z-index:1; }
    .toolbar .btn { padding:8px 10px; font-size:13px; }
    #output { margin-bottom: 12px; }   /* space above the toolbar */
    .hr { height:1px; background:#1a1d24; margin:10px 0; flex-basis:100%; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <div class="title">Sentence Split & Clean</div>
        <div class="muted">Paste anything → plain text → one sentence per line → blank line between.</div>
      </div>
      <div class="controls">
        <button id="convert" class="btn primary">Convert</button>
        <button id="copy" class="btn">Copy</button>
        <button id="download" class="btn">Download .txt</button>
        <button id="clear" class="btn ghost">Clear</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row" style="margin-bottom:6px">
          <div class="muted">Input</div>
          <label><input type="checkbox" id="stripHtml" checked /> Strip HTML/styling automatically</label>
        </div>
        <textarea id="input" placeholder="Paste rich text, HTML, Google Docs/Word content, transcripts, etc."></textarea>
        <div class="hint">Tip: leave “Strip HTML” on if you paste from Docs/Word/emails.</div>
      </div>

      <div class="card">
        <div class="row" style="margin-bottom:6px">
          <div class="muted">Output</div>
          <div id="stats" class="muted">Characters: 0 | Words: 0 | Sentences: 0 | Lines: 0</div>
        </div>
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
          <input type="checkbox" id="live" checked /> Live as you type
        </label>
        <textarea id="output" placeholder="Your cleaned, sentence-per-line text will appear here." readonly></textarea>

        <!-- Tools -->
        <div class="toolbar">
          <!-- Case conversion -->
          <button class="btn" id="case-sentence">Sentence case</button>
          <button class="btn" id="case-lower">lower case</button>
          <button class="btn" id="case-upper">UPPER CASE</button>
          <button class="btn" id="case-capitalized">Capitalized Case</button>
          <button class="btn" id="case-title">Title Case</button>
          <button class="btn" id="case-ap-title">AP title case – Google Ads</button>
          <button class="btn" id="case-alternating">aLtErNaTiNg cAsE</button>
          <button class="btn" id="case-inverse">Inverse Case</button>

          <div class="hr"></div>

          <!-- Dialect -->
          <button class="btn" id="dialect-us">Convert to English (US)</button>
          <button class="btn" id="dialect-uk">Convert to English (UK)</button>
        </div>

        <div class="hint">Adds an empty line between sentences by design. Tools change the output in-place.</div>
      </div>
    </div>

    <div class="footer">Built with vanilla JS. Uses <code>Intl.Segmenter</code> for accurate sentence splitting when available.</div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const inputEl = $('#input');
    const outputEl = $('#output');
    const stripHtmlEl = $('#stripHtml');
    const liveEl = $('#live');
    const statsEl = $('#stats');

    // --- Preserve acronyms / initialisms (extendable) ---
    const ACRONYMS = new Set([
      'AI','USA','US','UK','EU','U.S.','U.K.','NATO','FBI','CIA','HR','CEO','CFO','CTO','CRM','API','SMS','SEO','SEM','PDF','HTML','CSS'
    ]);

    // --- US/UK spelling maps (curated; extend freely) ---
    const US2UK = {
      'color':'colour','colors':'colours','honor':'honour','humor':'humour',
      'favorite':'favourite','favorites':'favourites',
      'organize':'organise','organizes':'organises','organizing':'organising','organized':'organised','organization':'organisation',
      'analyze':'analyse','analyzes':'analyses','analyzing':'analysing','analyzed':'analysed','analysis':'analysis',
      'optimize':'optimise','optimized':'optimised','optimizing':'optimising','optimization':'optimisation',
      'center':'centre','centers':'centres','meter':'metre','meters':'metres',
      'liter':'litre','liters':'litres',
      'defense':'defence','offense':'offence',
      'license':'licence', 'licensed':'licenced', /* noun vs verb simplified */
      'program':'programme', /* context dependent; simple approach */
      'aluminum':'aluminium','catalog':'catalogue','dialog':'dialogue',
      'traveled':'travelled','traveling':'travelling','traveler':'traveller',
      'gray':'grey'
    };
    const UK2US = Object.fromEntries(Object.entries(US2UK).map(([k,v]) => [v,k]));

    const COMMON_ABBR = [
      "Mr.", "Mrs.", "Ms.", "Dr.", "Prof.", "Sr.", "Jr.", "St.", "Mt.",
      "vs.", "etc.", "e.g.", "i.e.", "a.m.", "p.m.", "U.S.", "U.K.", "No."
    ];
    const ABBR_PLACEHOLDER = "\uE000"; // private-use char

    function detectHtml(s) { return /<\/?[a-z][\s\S]*>/i.test(s); }
    function preNormalizeWhitespace(s) {
      return s.replace(/\r\n?/g, "\n").replace(/[ \t]+\n/g, "\n").replace(/\u00A0/g, ' ');
    }
    function stripHtmlToText(s) {
      s = s.replace(/<\s*br\s*\/?>/gi, "\n");
      s = s.replace(/<\/\s*(p|div|li|h[1-6]|blockquote|tr)\s*>/gi, "\n");
      s = s.replace(/<style[\s\S]*?<\/style>/gi, "")
           .replace(/<script[\s\S]*?<\/script>/gi, "")
           .replace(/<[^>]+>/g, "");
      return s;
    }
    function protectAbbreviations(text) {
      let out = text;
      COMMON_ABBR.forEach(abbr => {
        const safe = abbr.replace(/\./g, ABBR_PLACEHOLDER);
        const re = new RegExp(abbr.replace('.', '\\.'), 'g');
        out = out.replace(re, safe);
      });
      return out;
    }
    function restoreAbbreviations(text) {
      return text.replace(new RegExp(ABBR_PLACEHOLDER, 'g'), '.');
    }
    function normalizeInternalSpaces(s) {
      return s.replace(/[ \t]{2,}/g, ' ').replace(/\n{3,}/g, "\n\n").trim();
    }
    function restoreAcronyms(text){
      // enforce preferred casing for known acronyms
      ACRONYMS.forEach(acr=>{
        const re = new RegExp(`\\b${acr.replace(/\./g,'\\.')}\\b`,'gi');
        text = text.replace(re, acr);
      });
      return text;
    }

    // Robust sentence splitter: punctuation OR any newline becomes a boundary; ellipses end sentences.
    function splitIntoSentences(text) {
      const ELLIP = "\uE001";  // ellipsis placeholder
      const MARK  = "\u241E";  // split marker

      let t = text
        .replace(/\u2026/g, "...")   // convert unicode ellipsis
        .replace(/\.{3,}/g, ELLIP);  // protect any 3+ dots as one token

      // AFTER punctuation (. ! ?) and AFTER ellipses
      t = t.replace(/([.!?]+["”’)\]]*)(?=\s|$)/g, `$1${MARK}`);
      t = t.replace(new RegExp(ELLIP + '(?=\\s|$)', 'g'), ELLIP + MARK);

      // Any newline(s) are also boundaries
      t = t.replace(/\n+/g, MARK);

      return t
        .split(MARK)
        .map(s => s.trim())
        .filter(Boolean)
        .map(s => s.replace(new RegExp(ELLIP, 'g'), '...'));
    }

    function updateStats(text) {
      const charCount = text.length;
      const wordCount = text.trim() ? text.trim().split(/\s+/).filter(Boolean).length : 0;
      const sentenceCount = text.trim() ? text.split(/\n\s*\n/).filter(Boolean).length : 0;
      const lineCount = text ? text.split(/\n/).filter(l => l.length > 0).length : 0;
      statsEl.textContent = `Characters: ${charCount} | Words: ${wordCount} | Sentences: ${sentenceCount} | Lines: ${lineCount}`;
    }

    function convert() {
      let raw = inputEl.value || "";
      if (!raw.trim()) { outputEl.value = ""; updateStats(""); return; }

      let text = preNormalizeWhitespace(raw);
      if (stripHtmlEl.checked && detectHtml(text)) text = stripHtmlToText(text);
      text = text.replace(/[ \t]{2,}/g, ' ').replace(/\n{2,}/g, "\n");

      const sentences = splitIntoSentences(text);
      const cleaned = sentences.map(s => normalizeInternalSpaces(s.replace(/\s*\n\s*/g, ' ').trim()));
      let out = cleaned.join("\n\n") + "\n";
      out = restoreAcronyms(out); // keep AI, USA, etc.
      outputEl.value = out;
      updateStats(out);
    }

    // Live mode ON by default + run once on load if input has text
    liveEl.checked = true;
    if (inputEl.value && inputEl.value.trim()) convert();

    // ---- Case conversion helpers (operate on OUTPUT text; preserve blank lines) ----
    function transformOutput(fn) {
      const newText = fn(outputEl.value || "");
      outputEl.value = restoreAcronyms(newText);
      updateStats(outputEl.value);
    }

    function toLower(text) { return text.toLowerCase(); }
    function toUpper(text) { return text.toUpperCase(); }
    function toInverse(text) {
      return text.replace(/[a-zA-Z]/g, ch => ch === ch.toLowerCase() ? ch.toUpperCase() : ch.toLowerCase());
    }
    function toAlternating(text) {
      let toggle = true;
      return text.split('').map(ch => {
        if (/[a-zA-Z]/.test(ch)) {
          const out = toggle ? ch.toLowerCase() : ch.toUpperCase();
          toggle = !toggle;
          return out;
        }
        return ch;
      }).join('');
    }

    // Capitalize after opening quotes/brackets; preserve acronyms
    function sentenceCapLine(line){
      const m = line.match(/^(\s*["“”‘’'(\[\{]*)(.*)$/);
      if(!m) return line;
      const lead = m[1], rest = m[2];
      const i = rest.search(/[A-Za-z]/);
      if(i === -1) return line;
      return lead + rest.slice(0,i) + rest[i].toUpperCase() + rest.slice(i+1);
    }
    function toSentenceCase(text) {
      return text.split('\n').map(line => {
        const trimmed = line.trim();
        if (!trimmed) return line; // keep blank lines
        const lower = trimmed.toLowerCase();
        return sentenceCapLine(lower);
      }).join('\n');
    }

    // Capitalized Case (each word), preserving acronyms
    function toCapitalized(text) {
      return text.replace(/\b([A-Za-zÁ-ÿ]+)\b/g, (w) => {
        if (ACRONYMS.has(w) || ACRONYMS.has(w.toUpperCase())) return w.toUpperCase();
        return w[0].toUpperCase() + w.slice(1).toLowerCase();
      });
    }

    // Generic Title Case + AP Title Case
    const SMALL_WORDS = new Set(['a','an','the','and','but','or','nor','for','so','yet','as','at','by','in','of','on','per','to','via','from','over','into','onto','off','up','down','with','without']);
    function titleCaseCore(line, apMode=false){
      const tokens = line.split(/(\s+)/); // keep spaces
      let first=-1,last=-1;
      for(let i=0;i<tokens.length;i++) if(/\S/.test(tokens[i])){ first=i; break; }
      for(let i=tokens.length-1;i>=0;i--) if(/\S/.test(tokens[i])){ last=i; break; }
      let afterStrongSep=false; // after : or — treat next as strong
      return tokens.map((tok,idx)=>{
        if(!/\S/.test(tok)) return tok;

        // strip punctuation for logic
        const plain = tok.replace(/[^A-Za-zÁ-ÿ'.-]/g,'');
        const isAcr = ACRONYMS.has(plain) || ACRONYMS.has(plain.toUpperCase());
        const isAllCapsShort = /^[A-Z]{2,5}$/.test(plain);
        if(isAcr || isAllCapsShort) return tok.replace(plain, plain.toUpperCase());

        const core = plain.toLowerCase();
        const edge = (idx===first || idx===last) || afterStrongSep;
        const isVerbShort = apMode && /^(is|am|are|be|been|being|was|were|do|does|did)$/.test(core);

        let out;
        if(!edge && !isVerbShort && SMALL_WORDS.has(core)){
          out = core; // small word in middle
        } else {
          out = core.split('-').map((part,i)=>{
            if (apMode && SMALL_WORDS.has(part) && i>0) return part;
            return part ? part[0].toUpperCase()+part.slice(1) : part;
          }).join('-');
        }
        const rebuilt = tok.replace(plain, out);
        afterStrongSep = /[:—–-]$/.test(tok);
        return rebuilt;
      }).join('');
    }
    function toTitleCase(text) { return text.split('\n').map(l=>titleCaseCore(l,false)).join('\n'); }
    function toAPTitleCase(text) { return text.split('\n').map(l=>titleCaseCore(l,true)).join('\n'); }

    // Dialect swap preserving case style
    function swapDialect(text, map){
      const keys = Object.keys(map).sort((a,b)=>b.length-a.length);
      let out = text;
      for(const k of keys){
        const v = map[k];
        const re = new RegExp(`\\b${k}\\b`,'gi');
        out = out.replace(re, (m)=>{
          if (m === m.toUpperCase()) return v.toUpperCase();
          if (m[0] === m[0].toUpperCase()) return v[0].toUpperCase()+v.slice(1);
          return v;
        });
      }
      return out;
    }

    // Buttons (kept all your originals, added new ones)
    $('#convert').addEventListener('click', convert);
    $('#copy').addEventListener('click', async () => {
      if (!outputEl.value) return;
      try { await navigator.clipboard.writeText(outputEl.value); flash('Copied!'); }
      catch { outputEl.select(); document.execCommand('copy'); flash('Copied!'); }
    });
    $('#download').addEventListener('click', () => {
      const blob = new Blob([outputEl.value || ""], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'cleaned_sentences.txt';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(a.href), 1000);
    });
    $('#clear').addEventListener('click', () => { inputEl.value = ""; outputEl.value = ""; updateStats(""); });
    inputEl.addEventListener('input', () => { if (liveEl.checked) convert(); });

    // Hook up case tools
    $('#case-lower').addEventListener('click', () => transformOutput(toLower));
    $('#case-upper').addEventListener('click', () => transformOutput(toUpper));
    $('#case-inverse').addEventListener('click', () => transformOutput(toInverse));
    $('#case-alternating').addEventListener('click', () => transformOutput(toAlternating));
    $('#case-capitalized').addEventListener('click', () => transformOutput(toCapitalized));
    $('#case-sentence').addEventListener('click', () => transformOutput(toSentenceCase));
    $('#case-title').addEventListener('click', () => transformOutput(toTitleCase));
    $('#case-ap-title').addEventListener('click', () => transformOutput(toAPTitleCase));

    // Dialect buttons
    $('#dialect-us').addEventListener('click', () => transformOutput(t=>swapDialect(t, UK2US)));
    $('#dialect-uk').addEventListener('click', () => transformOutput(t=>swapDialect(t, US2UK)));

    function flash(msg) {
      const b = document.createElement('div');
      b.textContent = msg;
      b.style.position='fixed'; b.style.right='16px'; b.style.bottom='16px';
      b.style.background='rgba(77,163,255,.95)'; b.style.color='#00142a';
      b.style.padding='10px 14px'; b.style.borderRadius='10px'; b.style.fontWeight='700';
      b.style.boxShadow='0 6px 30px rgba(0,0,0,.35)';
      document.body.appendChild(b);
      setTimeout(()=>b.remove(), 1200);
    }

    // Initialize stats on load
    updateStats("");
  </script>
</body>
</html>